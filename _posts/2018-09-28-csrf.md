---
layout: post
title: "Cross site request forgery (CSRF)"
thumbnail: todo-480.jpg
date: 2019-01-02
---

When you are logged in to a certain site, you typically have a session. The identifier of that session is stored in a cookie in your browser, and is sent with every request to that site. Even if some other site triggers a request, the cookie is sent along with the request and the request is handled as if the logged in user performed it.

Cross site request forgery (CSRF) is performing a "forged" request from the attacker's site to another site where the victim is logged in. If that site is vulnerable, any action that the user could normally perform on the site can now be performed by the attacker.

An interesting action to perform through CSRF is [changing the password](/2018/08/15/changing-your-password-with-csrf-in-icehrm/) or email address, as this results in account takeover. For passwords this is often impossible since you have to fill in the old password, but for email addresses this is sometimes forgotten.

Requests that perform some action are supposed to have CSRF protection and are interesting to test. Most of the time these are POST requests, but not always. Some sites do have CSRF protection on all POST requests, but not on GET requests. In that case it is interesting to search for a GET request that performs some action.

One request that can often be forged is to log out the user. On most sites, simply visiting `/logout` or something like that will log out the user. This is technically CSRF, although with a rather mundane impact.

CSRF protection is typically done by sending a random token along with any request. The attacker wouldn't have this token and thus can't forge a valid request.

Sometimes the site verifies the Referer or Origin headers to verify that the request came from the site itself. This can be secure, but is a bit harder to get correct. Sometimes the site checks whether "https://www.example.com/" is contained in the Referer, in which case it can be attacked by using "https://www.attacker.com/?https://www.example.com/" as the attacking page. Sometimes the check isn't done if the Referer header is missing, which the attacker can trigger through a [referrer policy](/2017/06/21/bypass-csrf-check-using-referrer-policy/).

Finally, [Same-Site cookies](/2016/04/14/preventing-csrf-with-samesite-cookie-attribute/) provide adequate protection against CSRF, but only for browsers that support them.

## Read more

* [CORS and RFC1918](https://wicg.github.io/cors-rfc1918/)
