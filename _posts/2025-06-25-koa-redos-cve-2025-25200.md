---
layout: post
title: "CVE-2025-25200: this Koa ReDoS is not a serious vulnerability"
thumbnail: snail-480.jpg
date: 2025-07-23
---

CVE-2025-25200 describes a regex denial of service (ReDoS) in the Koa web framework. While classified as critical, its actual impact is minimal.

<!-- Photo source: https://pixabay.com/photos/snail-shell-mollusk-snail-shell-6191155/ -->

When using a proxy, the user's IP address and the requested host name are often added to request headers (`X-Forwarded-For`, `X-Forwarded-Host`). These headers can contain multiple values, separated by commas. Koa splits these headers using an inefficient regular expression, which takes up much processing power for long headers:

```javascript
get host() {
    const proxy = this.app.proxy;
    let host = proxy && this.get('X-Forwarded-Host');
    // ...
    return host.split(/\s*,\s*/, 1)[0];
},
```

This regex has *O(n²)* time complexity. This means the time taken to process the input increases quadratically with the input's length.

## Redos

A Regular Expression Denial of Service (ReDoS) occurs when a poorly constructed regular expression encounters a specific input that causes it to take an excessive amount of time to process. This often happens due to 'catastrophic backtracking,' where the regex engine attempts many different paths to match a string, especially with nested quantifiers or overlapping alternatives within repeated groups. This leads to exponential or polynomial time complexity, effectively locking up the CPU.

ReDoS vulnerabilities are not inherent to all regular expression processing. While many popular regex engines, including the one in Node.js (V8's RegExp engine), rely on a backtracking algorithm that can lead to exponential time complexity in pathological cases, alternative approaches exist. Engines like Google's RE2, for instance, are designed to operate in guaranteed linear time relative to the input size. These engines achieve this by disallowing certain "advanced" regex features (like backreferences) that complicate efficient processing, or by employing different algorithms (like NFA-to-DFA conversion) that avoid catastrophic backtracking. Unfortunately, Node.js applications currently don't use such an engine by default, leaving them susceptible to these performance pitfalls if regex patterns are not carefully crafted.

## How it Works

The ReDoS occurs when a specially crafted X-Forwarded-Host or X-Forwarded-For header is processed. The regular expression used for splitting these headers becomes inefficient with certain patterns. This can cause the server to spend excessive time processing the request.

## Limited Scope: Proxy Requirement

This vulnerability only affects Koa applications where the proxy setting is enabled. By default, the Koa proxy setting is off. Additionally, the proxy must not strip X-Forwarded-* headers.

## Lazy Property Access

The vulnerability is only triggered if certain context properties are accessed.

- ctx.host must be read, and the request must include an X-Forwarded-Host header.
- ctx.ip or ctx.ips must be read, and the request must include an X-Forwarded-For header.

## Header Size Limitations

Node.js has a maximum HTTP header size limit. This limit is typically 16KB. Even with a 16KB payload, the ReDoS might cause a delay of around 200 milliseconds. This short delay further limits the impact of the vulnerability.

## Subsequent impact

The Common Vulnerability Scoring System (CVSS) often uses "Subsequent System Impact Metrics." For this ReDoS, the availability impact is rated as high. However, this refers to the availability of Koa itself, not necessarily subsequent systems. Koa is the directly impacted component.

## CVSS rant

CVSS rates confidentiality, integrity and availability impact the same. High confidentiality impact rates the same as high availability impact. I think this can be a valid viewpoint in some cases where there is permanent impact, but not in most other cases.

- High confidentiality impact: the app's database is dumped and released on a hacker forum. Your company is in the news for being hacked and your business takes a serious hit.
- High integrity impact: hackers add an admin account or encrypt all your files. They replace your homepage with "H@xed by 1337 haxors". Your company is in the news and your business takes a serious hit.
- High availability impact according to CVSS: hackers DDoS your server. You wait it out and release a statement that your company was the victim of a DDoS attack. Happens to everyone, nobody blames you.
- High availability impact, actually: hackers delete all your company data. Rebuilding your infrastructure from backups takes many weeks. Your company is in the news and your business takes a serious hit.

In this Koa ReDoS, the availability impact is temporary. The server becomes unresponsive for a short period when processing a malicious header. Once the connection times out or the request is completed, the server resumes normal operation. This differs significantly from a permanent denial of service or data loss.

## CVE rant

Rating a ReDoS as 9.8 critical does not make sense in any case. I feel that the reporter was hunting for high-risk CVEs for their resume. When reporting a vulnerability through GitHub, it is possible to enter your own CVSS score, and apparently the reporter made the most out of this. Both GitHub and NVD apparently did not perform basic checking of the CVSS score.

## Conclusion

The Koa ReDoS (CVE-2025-25200) is a textbook example of how a vulnerability's theoretical severity can diverge from its practical impact. While technically a denial of service, its "critical" classification is arguably inflated. This is largely due to the limited maximum header size in Node.js, which caps the potential for a prolonged attack. The need for specific proxy configurations and the lazy evaluation of properties further diminish its real-world threat. Ultimately, while patched, this vulnerability posed a very low risk to most Koa applications.

## Read more

- [Increase HTTP\_MAX\_HEADER\_SIZE to 16kb · Issue #27645 · nodejs/node](https://github.com/nodejs/node/issues/27645)
- [Inefficient Regular Expression Complexity in koa · Advisory · koajs/koa](https://github.com/koajs/koa/security/advisories/GHSA-593f-38f6-jp5m)
