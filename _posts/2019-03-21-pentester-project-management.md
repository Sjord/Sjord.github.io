---
layout: post
title: "My pentesting project management"
thumbnail: scaffold-480.jpg
date: 2019-09-11
---

When doing a project I want to keep all project data in one directory. I keep notes and logs to make reporting easier, and to be able to answer customer questions. Altough it's rare, sometimes it is necessary to go back through the logs to see what happened during the test. In that case you want the logs to be complete, and contain only information from that project. To make this easier, I have partly automated a workflow I will explain below.

## Requirements

The goal of my workflow is to easily store project data in the project folder, and to prevent contamination with other projects or non-project related work. 

## Using a virtual machine

I used to have a virtual machine running Kali Linux on which I did my penetration tests. By using a VM it is possible to make snapshots and revert to a clean state, making sure projects don't contaminate each other. However, virtual machines have some drawbacks:

* Copy-pasting between the VM and the host often breaks.
* The snapshots take up considerable disk space.
* The VM is not integrated in the windowing system of the host. Getting the VM to work right on multiple screens is a challenge.

Using a VM is particularly useful since it segments *all* your files. If you add a static mapping to `/etc/hosts`, it is gone as soon as you revert to a clean snapshot.

In practice, it sometimes still happens that project files end up in the "clean" VM snapshot. As with all systems like this, you have to remember to switch contexts.

Especially the problems with multiple screen led me to try another solution. At first I had one VM with a browser connected to another VM with Burp. However, this made little sense, especially when Burp started supporting projects in 2016.

## Running native

I switched to running the browser, Burp, and some other tools directly on MacOS and discarding the virtual machines.

Burp projects work great at separating data from different projects. For the browser I used to clear all data (⌘⇧⌦) every time I switched projects, but later I created a new Firefox profile for each project.

## Initializing a project

I created a shell script that initializes a new project. It creates a new directory with the given name, a new Firefox profile and a new Burp project. It creates these subdirectories in the project directory:

* `burp` stores the Burp project and log.
* `code` has any available source code.
* `screenshots` has all screenshots for this project.
* `project` has the project information such as the proposal.
* `bin` has some project specific scripts which I will explain below.

And finally, it creates a file `notes.txt` which is to contain all notes made during the project.

## Symlink for current project

Each project has its own directory. There is a symlink named `current` that points to the current project. This is automatically set by the project initialization script described above, and I can set it to any project when I change projects. This makes it easy to find the files for the current project, and I can configure tools to use this directory to save files in by default.

## Saving screenshots

Screenshots are saved to the screenshots directory in the current project. The following command changes the directory screenshots are saved to:

    defaults write com.apple.screencapture location /Users/me/Projects/current/screenshots

I also disabled the shadow effect in screenshots with this command:

    defaults write com.apple.screencapture disable-shadow true

So now I can take screenshots with ⌘⇧4 and they automatically end up in the correct directory.

## Firefox profile

The project initialization script creates a new Firefox profile specifically for the project. The following command creates the profile:

    /Applications/Firefox.app/Contents/MacOS/firefox -no-remote -CreateProfile "$project $profile_path"

After creating the project, the script copies a custom user.js into the profile folder, which contains some custom settings:

Save any downloaded files to the project directory, instead of the default Downloads directory.

    user_pref("browser.download.folderList", 2);
    user_pref("browser.download.dir", "/Users/itsec/Projects/PROJECT");

Show the current project name in the URL bar:

    user_pref("browser.urlbar.placeholderName", "PROJECT");

Don't suggest search terms in the URL bar: 

    user_pref("browser.urlbar.suggest.searches", false);

Enable the [MessPostage browser extension](https://github.com/Sjord/messpostage):

    user_pref("extensions.webextensions.uuids", "{\"webcompat@mozilla.org\":\"6d303bcd-47a1-584c-a42b-3735f351d811\",\"screenshots@mozilla.org\":\"459d5770-1566-154f-b862-7422f80ae902\",\"{cd982b7a-ece2-4476-a2bc-5b0d085ccbcd}\":\"1364d876-8814-2749-9a9e-c5a82c6a2b2c\"}");

Use Burp as proxy:

    user_pref("network.proxy.ftp", "localhost");
    user_pref("network.proxy.ftp_port", 8080);
    user_pref("network.proxy.http", "localhost");
    user_pref("network.proxy.http_port", 8080);
    user_pref("network.proxy.share_proxy_settings", true);
    user_pref("network.proxy.socks", "localhost");
    user_pref("network.proxy.socks_port", 8080);
    user_pref("network.proxy.ssl", "localhost");
    user_pref("network.proxy.ssl_port", 8080);
    user_pref("network.proxy.type", 1);

Don't warn about closing multiple tabs:

    user_pref("browser.tabs.warnOnClose", false);

## Burp configuration

For Burp, we specify which project and configuration files we want to use when starting Burp. The file `bin/burp` that starts Burp for the current project looks like this:
    
    ~/bin/burp --project-file='$PWD/burp/$project.burp' --config-file='$PWD/burp/$project.conf.json' --unpause-spider-and-scanner

The configuration file in turn enables logging to `/burp/$project.log`.

## Other tools

Sqlmap stores files in ~/.sqlmap by default. I made this a symlink to ~/Projects/current/sqlmap.

For dirsearch or other tools, I have to specify the output file manually.

## Conclusion

